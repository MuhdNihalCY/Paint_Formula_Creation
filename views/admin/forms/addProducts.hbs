<section>
    <div class="ADProductsAddingFormDiv">
        <div class="container">
            <div class="ADProductsAddingMainDiv">
                <div class="ADProductsAddingFormDiv__title">
                    {{#if editProduct}}
                    <p>Edit product</p>
                    {{else}}
                    <p>Add product</p>
                    {{/if}}
                    <hr>
                </div>
                {{#if editProduct}}
                <form action="/admin/UpdateProducts" method="post">
                    {{else}}
                    <form action="/admin/addProducts" method="post">
                        {{/if}}
                        <div class="ADFormAdding">
                            <div class="ADFormAddingCatgorySelection">
                                <div class="ADFromAddingSingleRow">
                                    <p class="ADSubCategorySelectionLabel">Select Category</p>
                                    <select required class="ADSubCategorySelectionSelectBox" name="Category"
                                        id="CategorySelect">
                                        {{#if editProduct}}
                                        <option class="ADSelectCategoryOptions"
                                            value="{{matchingCategory.Category_Id}}">
                                            {{matchingCategory.Category_Id}} - {{matchingCategory.Category}}</option>
                                        {{#each NotMatchingCategories}}
                                        <option class="ADSelectCategoryOptions" value="{{this.Category_Id}}">
                                            {{this.Category_Id}} -
                                            {{this.Category}}</option>
                                        {{/each}}

                                        {{else}}
                                        {{#each AllCategory}}
                                        <option class="ADSelectCategoryOptions" value="{{this.Category_Id}}">
                                            {{this.Category_Id}} -
                                            {{this.Category}}</option>
                                        {{/each}}
                                        {{/if}}
                                    </select>
                                </div>
                                <div class="ADFromAddingSingleRow">
                                    <p class="ADSubCategorySelectionLabel">Select Sub Category</p>
                                    <select required class="ADSubCategorySelectionSelectBox" name="SubCategory"
                                        id="SubCategorySelect">
                                        {{#if editProduct}}
                                        <option class="ADSelectCategoryOptions"
                                            value="{{matchingSubCategory.SubCategory_Id}}">
                                            {{matchingSubCategory.SubCategory_Id}} - {{matchingSubCategory.SubCategory}}
                                        </option>
                                        {{#each NotMatchingSubCategory}}
                                        <option class="ADSelectCategoryOptions" value="{{this.SubCategory_Id}}">
                                            {{this.SubCategory_Id}} - {{this.SubCategory}}</option>
                                        {{/each}}
                                        {{else}}
                                        {{#each AllSubCategory}}
                                        <option class="ADSelectCategoryOptions" value="{{this.SubCategory_Id}}">
                                            {{this.SubCategory_Id}} - {{this.SubCategory}}</option>
                                        {{/each}}
                                        {{/if}}
                                    </select>
                                </div>
                            </div>
                            <div class="ADFormAddingCatgorySelection">
                                <div class="ADFromAddingSingleRow">
                                    <p class="ADSubCategorySelectionLabel">Product Name</p>
                                    {{#if editProduct}}
                                    <input type="text" name="Product_Name" class="ADProductInputBox"
                                        value="{{product.Product_Name}}" required>
                                    <input type="text" name="Product_Id" class="ADProductInputBox"
                                        value="{{product.Product_Id}}" hidden required>
                                    {{else}}
                                    <input type="text" name="Product_Name" class="ADProductInputBox" required>
                                    {{/if}}
                                </div>
                                <div class="ADFromAddingSingleRow">
                                    <p class="ADSubCategorySelectionLabel">Density (ml/1000g)</p>
                                    {{#if editProduct}}
                                    <input type="text" name="Product_Density" class="ADProductInputBox"
                                        value="{{product.Product_Density}}" required>
                                    {{else}}
                                    <input type="text" name="Product_Density" class="ADProductInputBox" required>
                                    {{/if}}
                                </div>
                            </div>
                            <div class="ADFormAddingCatgorySelection">
                                <div class="ADFromAddingSingleRow">
                                    <p class="ADSubCategorySelectionLabel">Price (in liter)</p>
                                    {{#if editProduct}}
                                    <input type="number" step="any" name="Price_Liter" class="ADProductInputBox"
                                        value="{{product.Price_Liter}}" required>
                                    {{else}}
                                    <input type="number" step="any" name="Price_Liter" class="ADProductInputBox"
                                        required>
                                    {{/if}}
                                </div>
                                <div class="ADFromAddingSingleRow">
                                    <p class="ADSubCategorySelectionLabel">Price (in kilogram)</p>
                                    {{#if editProduct}}
                                    <input type="number" step="any" name="Price_Kilogram" class="ADProductInputBox"
                                        value="{{product.Price_Kilogram}}" required>
                                    {{else}}
                                    <input type="number" step="any" name="Price_Kilogram" class="ADProductInputBox"
                                        required>
                                    {{/if}}
                                </div>
                            </div>
                            <div class="ADFormAddingCatgorySelection">
                                <div class="ADFromAddingSingleRow">
                                    <p class="ADSubCategorySelectionLabel">VOC</p>
                                    {{#if editProduct}}
                                    <input type="number" step="any" name="VOC" class="ADProductInputBox"
                                        value="{{product.VOC}}" required>
                                    {{else}}
                                    <input type="number" step="any" name="VOC" class="ADProductInputBox" required>
                                    {{/if}}
                                </div>
                                <div class="ADFromAddingSingleRow">
                                    <p class="ADSubCategorySelectionLabel">Solid Content</p>
                                    {{#if editProduct}}
                                    <input type="number" step="any" name="SolidContent" class="ADProductInputBox"
                                        value="{{product.SolidContent}}" required>
                                    {{else}}
                                    <input type="number" step="any" name="SolidContent" class="ADProductInputBox"
                                        required>
                                    {{/if}}
                                </div>
                            </div>
                            <div class="ADFormAddingCatgorySelection">
                                <div class="ADFromAddingSingleRow">
                                    <p class="ADSubCategorySelectionLabel">Stock</p>
                                    {{#if editProduct}}
                                    <input type="number" name="Stock" class="ADProductInputBox"
                                        value="{{product.Stock}}" required>
                                    {{else}}
                                    <input type="number" name="Stock" class="ADProductInputBox" required>
                                    {{/if}}
                                </div>
                            </div>
                            <button class="ADPRoductSubmitBTN" type="submit"> Submit </button>
                            {{#if editProduct}}
                            <script>
                                function confirmProductDelete() {
                                    return confirm('Are you sure you want to delete this product?');
                                }
                            </script>
                            <a class="btn btn-danger productDeleteBTN" href="/admin/DeleteProduct/{{product.Product_Id}}"
                                onclick="return confirmProductDelete()">Delete Product</a>
                            {{/if}}
                        </div>

                    </form>
            </div>
        </div>
    </div>
</section>


<script>
    //ajax
    function ADgetAllSubCategories() {
        return fetch('/admin/Subcategories/api')
            .then(response => response.json())
            .catch(error => {
                console.log('Error:', error);
            });
    }

    function ADgetAllCategories() {
        return fetch('/admin/Categories/api')
            .then(response => response.json())
            .catch(error => {
                console.log('Error:', error);
            });
    }

    Promise.all([ADgetAllSubCategories(), ADgetAllCategories()])
        .then(([subCategories, categories]) => {
            // Process the retrieved subcategories and categories
            console.log(subCategories);
            console.log(categories);

            // Assign the values to the variables
            var subCategories = subCategories;
            var categories = categories;

            // Continue with your code here...



            // Get the category select element
            const categorySelect = document.getElementById('CategorySelect');

            // Get the subcategory select element
            const subCategorySelect = document.getElementById('SubCategorySelect');

            // Add an event listener to the category select element
            categorySelect.addEventListener('change', () => {
                // Get the selected category ID
                const categoryId = categorySelect.value;

                // Filter the subcategories based on the selected category ID
                const filteredSubCategories = subCategories.filter(subCategory => subCategory.Category_Id === categoryId);

                // Clear the subcategory select box
                subCategorySelect.innerHTML = '';

                // Create and append the option elements for the filtered subcategories

                if (filteredSubCategories.length > 0) {
                    filteredSubCategories.forEach(subCategory => {
                        const option = document.createElement('option');
                        option.value = subCategory.SubCategory_Id;
                        option.textContent = subCategory.SubCategory;
                        subCategorySelect.appendChild(option);
                    });
                    // Enable the subcategory select box
                    subCategorySelect.disabled = false;
                } else {
                    // Add a "No Subcategory" option
                    const option = document.createElement('option');
                    option.textContent = 'No SubCategory available';
                    subCategorySelect.appendChild(option);

                    // Disable the subcategory select box
                    subCategorySelect.disabled = true;
                }
            });
        });

</script>